<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ËÅäÂ§©Á∑¥Áøí</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom pulsating animation for AI speaking */
        @keyframes pulse-speak {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pulse-speak {
            animation: pulse-speak 1s infinite ease-in-out;
        }
    </style>
    <!-- React and ReactDOM CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX transformation in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Main App Component
        const App = () => {
            // State variables for managing the application's flow and data
            const [selectedTopic, setSelectedTopic] = React.useState(null); // Stores the currently selected topic
            const [conversation, setConversation] = React.useState([]); // Stores the history of the conversation (AI and user messages)
            const [userInput, setUserInput] = React.useState(''); // Stores the user's current input in the text field
            const [isLoading, setIsLoading] = React.useState(false); // Indicates if an AI response is being loaded
            const [feedback, setFeedback] = React.useState(null); // Stores the final feedback and score from the AI
            const [turnCount, setTurnCount] = React.useState(0); // Tracks the number of turns in the conversation
            const [showHint, setShowHint] = React.useState(false); // Controls the visibility of the hint message
            const [hintText, setHintText] = React.useState(''); // Stores the hint text
            const [isListening, setIsListening] = React.useState(false); // Indicates if speech recognition is active
            const [speechError, setSpeechError] = React.useState(''); // Stores any speech recognition errors
            const [isSpeakingAI, setIsSpeakingAI] = React.useState(false); // Indicates if AI is currently speaking
            const [voices, setVoices] = React.useState([]); // Available text-to-speech voices
            const [selectedVoice, setSelectedVoice] = React.useState(null); // Currently selected AI voice
            const [difficulty, setDifficulty] = React.useState('Beginner'); // Conversation difficulty level

            const conversationEndRef = React.useRef(null); // Ref to scroll to the end of the conversation
            const recognitionRef = React.useRef(null); // Ref for SpeechRecognition object

            // Pre-defined topics for the chat
            const topics = [
                'Shopping', 'Airport', 'Restaurant', 'Hotel Check-in',
                'Asking for Directions', 'Job Interview', 'Doctor\'s Appointment',
                'Making Small Talk', 'Ordering Coffee', 'Discussing Hobbies'
            ];

            // Difficulty levels
            const difficultyLevels = ['Beginner', 'Intermediate', 'Advanced'];

            // Effect to scroll to the bottom of the conversation whenever it updates
            React.useEffect(() => {
                if (conversationEndRef.current) {
                    conversationEndRef.current.scrollIntoView({ behavior: 'smooth' });
                }
            }, [conversation]);

            // Initialize SpeechRecognition and SpeechSynthesis
            React.useEffect(() => {
                // Speech Recognition setup
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (SpeechRecognition) {
                    recognitionRef.current = new SpeechRecognition();
                    recognitionRef.current.continuous = false; // Stop after a single utterance
                    recognitionRef.current.interimResults = false; // Only return final results
                    recognitionRef.current.lang = 'en-US'; // Set recognition language to English (US) for better accuracy

                    recognitionRef.current.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        setUserInput(transcript); // Set transcribed text to input field
                        setIsListening(false); // Stop listening indicator
                        setSpeechError(''); // Clear any previous speech errors
                        playBeep(false); // Play end recording beep
                    };

                    recognitionRef.current.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        setSpeechError(`Ë™ûÈü≥Ëæ®Ë≠òÈåØË™§Ôºö${event.error}`); // Translated error message
                        setIsListening(false);
                        playBeep(false); // Play end recording beep on error
                    };

                    recognitionRef.current.onend = () => {
                        setIsListening(false); // Ensure listening state is false when recognition ends
                        playBeep(false); // Play end recording beep
                    };
                } else {
                    setSpeechError('Ê≠§ÁÄèË¶ΩÂô®‰∏çÊîØÊè¥Ë™ûÈü≥Ëæ®Ë≠ò„ÄÇ'); // Translated error message
                    console.warn('Web Speech API (SpeechRecognition) not supported in this browser.');
                }

                // Speech Synthesis (Text-to-Speech) setup
                const loadVoices = () => {
                    const availableVoices = window.speechSynthesis.getVoices();
                    setVoices(availableVoices.filter(voice => voice.lang.startsWith('en'))); // Filter for English voices
                    // Try to find a British English voice by default
                    const britishVoice = availableVoices.find(voice => voice.lang === 'en-GB');
                    setSelectedVoice(britishVoice || availableVoices[0] || null); // Set default or first available
                };

                // Load voices immediately if they are already available
                if (window.speechSynthesis.getVoices().length > 0) {
                    loadVoices();
                } else {
                    // Otherwise, wait for voices to be loaded
                    window.speechSynthesis.onvoiceschanged = loadVoices;
                }

                // Clean up recognition object and speech synthesis on component unmount
                return () => {
                    if (recognitionRef.current) {
                        recognitionRef.current.stop();
                    }
                    window.speechSynthesis.cancel(); // Stop any ongoing speech
                };
            }, []);

            // Function to play a simple beep sound
            const playBeep = (isStart) => {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(isStart ? 600 : 400, audioContext.currentTime); // Different freq for start/end
                    gainNode.gain.setValueAtTime(0.5, audioContext.currentTime); // Volume

                    oscillator.start();
                    gainNode.gain.exponentialRampToValueAtTime(0.00001, audioContext.currentTime + 0.2); // Fade out
                    oscillator.stop(audioContext.currentTime + 0.2); // Stop after 0.2 seconds
                } catch (e) {
                    console.warn("Could not play beep sound:", e);
                }
            };

            // Function to speak text using SpeechSynthesis
            const speakText = (text) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel(); // Stop any previous speech
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = selectedVoice ? selectedVoice.lang : 'en-GB'; // Use selected voice lang
                    utterance.voice = selectedVoice; // Set selected voice

                    utterance.onstart = () => setIsSpeakingAI(true);
                    utterance.onend = () => setIsSpeakingAI(false);
                    utterance.onerror = (event) => {
                        console.error('Speech synthesis error:', event);
                        setIsSpeakingAI(false);
                    };

                    window.speechSynthesis.speak(utterance);
                } else {
                    console.warn('Text-to-speech not supported in this browser.');
                }
            };

            // Function to call the Gemini API
            const callGeminiAPI = async (prompt, schema = null) => {
                setIsLoading(true); // Set loading state to true
                let chatHistory = [];
                // Add existing conversation to chat history for context
                conversation.forEach(msg => {
                    chatHistory.push({ role: msg.sender === 'AI' ? 'model' : 'user', parts: [{ text: msg.text }] });
                });
                // Add the current prompt from the user/system
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = { contents: chatHistory };
                if (schema) {
                    payload.generationConfig = {
                        responseMimeType: "application/json",
                        responseSchema: schema
                    };
                }

                const apiKey = "__NETLIFY_API_KEY__"; // This will be replaced by Netlify environment variable
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        setIsLoading(false); // Set loading state to false
                        return schema ? JSON.parse(text) : text; // Parse JSON if schema was used
                    } else {
                        console.error('Unexpected API response structure:', result);
                        setIsLoading(false);
                        return 'ÈåØË™§ÔºöÁÑ°Ê≥ïÂæûAIÁç≤ÂæóÂõûÊáâ„ÄÇ'; // Translated error message
                    }
                } catch (error) {
                    console.error('Error calling Gemini API:', error);
                    setIsLoading(false);
                    return 'ÈåØË™§ÔºöÁÑ°Ê≥ïÈÄ£Êé•Âà∞AI„ÄÇ'; // Translated error message
                }
            };

            // Function to start a new conversation with the selected topic
            const startConversation = async (topic) => {
                setSelectedTopic(topic);
                setConversation([]);
                setFeedback(null);
                setTurnCount(0);
                setShowHint(false);
                setHintText('');
                setSpeechError(''); // Clear speech errors on new conversation

                // Request AI to start conversation with a direct question in the scenario
                let prompt;
                switch (topic) {
                    case 'Restaurant':
                        prompt = `You are a server in a restaurant. Start the conversation by asking a direct question to the customer, like "What can I get for you today, sir/madam?" or "Are you ready to order?". Include appropriate emojis in your response. Adjust vocabulary and sentence structure for a ${difficulty} level.`;
                        break;
                    case 'Airport':
                        prompt = `You are an airport check-in agent. Start the conversation by asking a direct question about the passenger's flight, like "What is your flight today?" or "Do you have your passport and ticket ready?". Include appropriate emojis in your response. Adjust vocabulary and sentence structure for a ${difficulty} level.`;
                        break;
                    case 'Shopping':
                        prompt = `You are a shop assistant. Start the conversation by asking a direct question to the customer, like "Can I help you find anything today?" or "Are you looking for something specific?". Include appropriate emojis in your response. Adjust vocabulary and sentence structure for a ${difficulty} level.`;
                        break;
                    case 'Hotel Check-in':
                        prompt = `You are a hotel receptionist. Start the conversation by asking a direct question for check-in, like "Welcome to our hotel. Do you have a reservation?" or "May I have your name, please?". Include appropriate emojis in your response. Adjust vocabulary and sentence structure for a ${difficulty} level.`;
                        break;
                    case 'Asking for Directions':
                        prompt = `You are a person being asked for directions. Start the conversation by acknowledging the user's need, like "Hello, can I help you find something?" or "Are you lost?". Include appropriate emojis in your response. Adjust vocabulary and sentence structure for a ${difficulty} level.`;
                        break;
                    case 'Job Interview':
                        prompt = `You are an interviewer. Start the conversation with a common opening interview question, like "Tell me a little bit about yourself." or "Why are you interested in this position?". Include appropriate emojis in your response. Adjust vocabulary and sentence structure for a ${difficulty} level.`;
                        break;
                    case 'Doctor\'s Appointment':
                        prompt = `You are a doctor or a nurse. Start the conversation by asking about the patient's reason for visit, like "What brings you in today?" or "How are you feeling?". Include appropriate emojis in your response. Adjust vocabulary and sentence structure for a ${difficulty} level.`;
                        break;
                    case 'Making Small Talk':
                        prompt = `You are meeting someone new. Start the conversation with a casual, open-ended question for small talk, like "How's your day going so far?" or "Lovely weather, isn't it?". Include appropriate emojis in your response. Adjust vocabulary and sentence structure for a ${difficulty} level.`;
                        break;
                    case 'Ordering Coffee':
                        prompt = `You are a barista. Start the conversation by asking what the customer would like to order, like "What can I get for you?" or "Ready to order?". Include appropriate emojis in your response. Adjust vocabulary and sentence structure for a ${difficulty} level.`;
                        break;
                    case 'Discussing Hobbies':
                        prompt = `You are meeting someone who shares a common interest. Start the conversation by asking about their hobbies, like "So, what do you like to do in your free time?" or "Any interesting hobbies you've picked up lately?". Include appropriate emojis in your response. Adjust vocabulary and sentence structure for a ${difficulty} level.`;
                        break;
                    default:
                        prompt = `Start an engaging conversation about "${topic}". The AI should speak first with an inviting and natural opening line, setting a vivid scene for a conversation practice exercise. Keep the response concise but interesting, perhaps one or two sentences. Include appropriate emojis in your response. Adjust vocabulary and sentence structure for a ${difficulty} level.`;
                }

                const aiResponse = await callGeminiAPI(prompt);
                setConversation([{ sender: 'AI', text: aiResponse }]);
                speakText(aiResponse); // Speak the AI's first response
                setTurnCount(1); // AI's first turn
            };

            // Function to handle user sending a message (either typed or spoken)
            const sendMessage = async () => {
                if (!userInput.trim() || isLoading) return; // Prevent sending empty messages or while loading

                const newUserMessage = { sender: 'User', text: userInput };
                const updatedConversation = [...conversation, newUserMessage];
                setConversation(updatedConversation);
                setUserInput(''); // Clear user input field
                setShowHint(false); // Hide hint after user sends a message

                // Check if conversation should end
                if (turnCount >= 10) {
                    // Conclude conversation and get feedback
                    await getConversationFeedback(updatedConversation);
                } else {
                    // Get AI's response for the next turn, keeping it engaging but concise
                    const aiPrompt = `Given the conversation history: ${updatedConversation.map(m => `${m.sender}: ${m.text}`).join('\n')}\n\nUser just said: "${userInput}". What should the AI say next to continue the conversation naturally and engagingly? Keep the response concise, perhaps one or two sentences with a follow-up question. Include appropriate emojis in your response. Adjust vocabulary and sentence structure for a ${difficulty} level.`;
                    const aiResponse = await callGeminiAPI(aiPrompt);
                    setConversation(prev => {
                        const newConv = [...prev, { sender: 'AI', text: aiResponse }];
                        speakText(aiResponse); // Speak the AI's response
                        return newConv;
                    });
                    setTurnCount(prev => prev + 1);
                }
            };

            // Function to request a hint from the AI
            const requestHint = async () => {
                if (isLoading) return;
                const prompt = `Given the current conversation: ${conversation.map(m => `${m.sender}: ${m.text}`).join('\n')}\n\nI need a hint for what to say next as the user. Provide a very short, concise suggestion or question I could ask. Include appropriate emojis. Adjust vocabulary and sentence structure for a ${difficulty} level.`;
                const hint = await callGeminiAPI(prompt);
                setHintText(hint);
                setShowHint(true);
            };

            // Function to start speech recognition
            const startListening = () => {
                if (isListening) { // Prevent starting if already listening
                    console.warn('Speech recognition already active.');
                    return;
                }
                if (recognitionRef.current) {
                    setSpeechError(''); // Clear previous errors
                    recognitionRef.current.stop(); // Stop any previous recognition before starting a new one
                    setIsListening(true);
                    playBeep(true); // Play start recording beep
                    recognitionRef.current.start();
                } else {
                    setSpeechError('Ë™ûÈü≥Ëæ®Ë≠ò‰∏çÂèØÁî®„ÄÇ'); // Translated error message
                }
            };

            // Function to get final feedback and score from the AI
            const getConversationFeedback = async (finalConversation) => {
                const conversationText = finalConversation.map(msg => `${msg.sender}: ${msg.text}`).join('\n');
                const feedbackPrompt = `The following is a conversation between a user and an AI about the topic "${selectedTopic}".
                Conversation:\n${conversationText}\n\n
                Please provide feedback on the user's choice of words, grammar, and overall usage.
                Then, give a score from 0 to 100 based on their performance.
                Structure your response as a JSON object with 'score' (number) and 'recommendations' (string) fields.
                Include relevant emojis in the score and recommendations to make them more engaging.
                Example: {"score": 85, "recommendations": "Good vocabulary, but work on verb tenses. Try to use more varied sentence structures. üëç"}`;

                const feedbackSchema = {
                    type: "OBJECT",
                    properties: {
                        "score": { "type": "NUMBER" },
                        "recommendations": { "type": "STRING" }
                    },
                    propertyOrdering: ["score", "recommendations"]
                };

                const aiFeedback = await callGeminiAPI(feedbackPrompt, feedbackSchema);
                setFeedback(aiFeedback);
                setSelectedTopic(null); // Reset topic to show topic selection again
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-100 to-purple-100 flex items-center justify-center p-4 font-inter">
                    <div className="bg-white rounded-xl shadow-2xl w-full max-w-3xl flex flex-col md:flex-row overflow-hidden">
                        {/* Left Panel: Topic Selection or Back Button */}
                        <div className="w-full md:w-1/3 bg-blue-600 text-white p-6 flex flex-col justify-between rounded-t-xl md:rounded-l-xl md:rounded-tr-none">
                            {selectedTopic ? (
                                <button
                                    onClick={() => setSelectedTopic(null)}
                                    className="bg-blue-700 hover:bg-blue-800 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105"
                                >
                                    ‚Üê ËøîÂõû‰∏ªÈ°å
                                </button>
                            ) : (
                                <div>
                                    <h2 className="text-3xl font-bold mb-6 text-center">ÈÅ∏Êìá‰∏ÄÂÄã‰∏ªÈ°å</h2>
                                    <div className="grid grid-cols-2 gap-3">
                                        {topics.map(topic => (
                                            <button
                                                key={topic}
                                                onClick={() => startConversation(topic)}
                                                className="bg-blue-500 hover:bg-blue-700 text-white font-semibold py-4 px-2 text-sm rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 text-center whitespace-normal flex items-center justify-center min-h-16"
                                            >
                                                {topic}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Right Panel: Chat Area or Feedback */}
                        <div className="w-full md:w-2/3 p-6 flex flex-col">
                            {selectedTopic && !feedback ? (
                                <>
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4 text-center">
                                        Ê≠£Âú®ËÅäÂ§©‰∏ªÈ°åÔºö<span className="text-blue-600">{selectedTopic}</span> (ÂõûÂêàÔºö{turnCount}/10)
                                    </h2>
                                    <div className="flex-1 overflow-y-auto border border-gray-200 rounded-lg p-4 mb-4 bg-gray-50 shadow-inner">
                                        {conversation.map((msg, index) => (
                                            <div
                                                key={index}
                                                className={`mb-3 p-3 rounded-lg max-w-[80%] ${msg.sender === 'User' ? 'bg-blue-100 text-blue-800 ml-auto' : 'bg-gray-200 text-gray-800 mr-auto'}`}
                                            >
                                                <div className="flex items-center mb-1">
                                                    {msg.sender === 'AI' && (
                                                        <span className={`mr-2 text-2xl ${isSpeakingAI && index === conversation.length -1 ? 'animate-pulse-speak' : ''}`}>ü§ñ</span>
                                                    )}
                                                    <p className="font-semibold">{msg.sender === 'AI' ? 'AI' : '‰ΩøÁî®ËÄÖ'}:</p>
                                                </div>
                                                <p>{msg.text}</p>
                                            </div>
                                        ))}
                                        {isLoading && (
                                            <div className="flex justify-center items-center py-4">
                                                <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                                                <span className="ml-2 text-gray-600">AIÊ≠£Âú®ÊÄùËÄÉ...</span>
                                            </div>
                                        )}
                                        <div ref={conversationEndRef} /> {/* Scroll target */}
                                    </div>

                                    {showHint && hintText && (
                                        <div className="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded-lg relative mb-4">
                                            <p className="font-bold">ÊèêÁ§∫Ôºö</p>
                                            <p>{hintText}</p>
                                        </div>
                                    )}

                                    {speechError && (
                                        <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative mb-4">
                                            <p className="font-bold">ÈåØË™§Ôºö</p>
                                            <p>{speechError}</p>
                                        </div>
                                    )}

                                    <div className="flex gap-2 items-center pr-6">
                                        <input
                                            type="text"
                                            value={userInput}
                                            onChange={(e) => setUserInput(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                                            placeholder={isListening ? "Ê≠£Âú®ËÅÜËÅΩ..." : "Ëº∏ÂÖ•ÊÇ®ÁöÑË®äÊÅØÊàñË™™Ë©±..."}
                                            className="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            disabled={isLoading || isListening}
                                        />
                                        <button
                                            onClick={startListening}
                                            className={`py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 flex items-center justify-center ${isListening ? 'bg-red-500 text-white animate-pulse' : 'bg-green-600 hover:bg-green-700 text-white'} min-w-[100px]`}
                                            disabled={isLoading || !recognitionRef.current}
                                            title={isListening ? "Ê≠£Âú®ËÅÜËÅΩ..." : "Ë™™Âá∫ÊÇ®ÁöÑË®äÊÅØ"}
                                        >
                                            {isListening ? (
                                                <svg className="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fillRule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0 5 5 0 01-5 5v1.085l3.931 3.931a1 1 0 001.414-1.414L12 14.085V13a1 1 0 10-2 0v1.085l-1.931 1.931a1 1 0 001.414 1.414L10 14.085V15a1 1 0 002 0v-.915z" clipRule="evenodd"></path></svg>
                                            ) : (
                                                <svg className="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fillRule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0 5 5 0 01-5 5v1.085l3.931 3.931a1 1 0 001.414-1.414L12 14.085V13a1 1 0 10-2 0v1.085l-1.931 1.931a1 1 0 001.414 1.414L10 14.085V15a1 1 0 002 0v-.915z" clipRule="evenodd"></path></svg>
                                            )}
                                            {isListening ? 'Ê≠£Âú®ËÅÜËÅΩ...' : 'Ë™™Ë©±'}
                                        </button>
                                        <button
                                            onClick={sendMessage}
                                            className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105"
                                            disabled={isLoading || isListening}
                                        >
                                            ÂÇ≥ÈÄÅ
                                        </button>
                                        <button
                                            onClick={requestHint}
                                            className="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105"
                                            disabled={isLoading || isListening}
                                        >
                                            ÊèêÁ§∫
                                        </button>
                                    </div>
                                </>
                            ) : feedback ? (
                                <div className="flex flex-col items-center justify-center h-full text-center">
                                    <h2 className="text-3xl font-bold text-gray-800 mb-4">Â∞çË©±ÁµêÊùüÔºÅ</h2>
                                    <div className="bg-green-100 border border-green-400 text-green-700 px-6 py-4 rounded-lg shadow-lg mb-6 w-full max-w-md">
                                        <p className="text-xl font-bold mb-2">ÊÇ®ÁöÑÂàÜÊï∏Ôºö<span className="text-green-800 text-4xl">{feedback.score}/100</span></p>
                                        <p className="text-lg font-semibold mb-2">Âª∫Ë≠∞Ôºö</p>
                                        <p className="text-md">{feedback.recommendations}</p>
                                    </div>
                                    <button
                                        onClick={() => {
                                            setSelectedTopic(null);
                                            setFeedback(null);
                                            setConversation([]);
                                            setTurnCount(0);
                                        }}
                                        className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105"
                                    >
                                        ÈñãÂßãÊñ∞Â∞çË©±
                                    </button>
                                </div>
                            ) : (
                                <div className="flex flex-col items-center justify-center h-full text-center">
                                    <h1 className="text-4xl font-extrabold text-gray-800 mb-4">Ê≠°Ëøé‰æÜÂà∞AIËÅäÂ§©Á∑¥ÁøíÔºÅ</h1>
                                    <p className="text-lg text-gray-600 mb-8">Ë´ãÂæûÂ∑¶ÂÅ¥Èù¢ÊùøÈÅ∏Êìá‰∏ÄÂÄã‰∏ªÈ°åÔºåÈñãÂßãËàáAIÂ∞çË©±„ÄÇ</p>
                                    {/* Difficulty Level Selector moved here */}
                                    <div className="flex items-center justify-center gap-2 mb-8">
                                        <label htmlFor="difficulty-select" className="text-gray-700 font-semibold">Èõ£Â∫¶Á≠âÁ¥öÔºö</label>
                                        <select
                                            id="difficulty-select"
                                            value={difficulty}
                                            onChange={(e) => setDifficulty(e.target.value)}
                                            className="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        >
                                            {difficultyLevels.map(level => (
                                                <option key={level} value={level}>{level === 'Beginner' ? 'ÂàùÁ¥ö' : level === 'Intermediate' ? '‰∏≠Á¥ö' : 'È´òÁ¥ö'}</option>
                                            ))}
                                        </select>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Render the App component to the root div
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
